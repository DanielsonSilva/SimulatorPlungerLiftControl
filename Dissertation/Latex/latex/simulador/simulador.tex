%%
%% Capítulo 3: Simulador Computacional
%%
\mychapter{Simulador Computacional}
\label{Cap:simulador}
Um simulador computacional é uma ferramenta auxiliar no processo do estudo de um certo procedimento, simples ou complexo, que evita a má gerência de um sistema específico. A alteração de parâmetros iniciais em um procedimento pode ser estudada antes por um simulador computacional para ter maior segurança quando esta alteração for realizada em um sistema real. Na aquisição de conhecimento sobre o procedimento através do simulador, o operador será capaz de compreender e testar formas de otimizar aquele sistema específico seguindo algum objetivo especial. Alcançada esta otimização no simulador e verificada através de testes, o operador poderá ter mais garantia de sucesso ao aplicar a técnica em um processo.

Com a finalidade de preparação para a implementação dos controladores descritos na seção \ref{Sec:controle}, foi desenvolvido e está sendo melhorado um aplicativo \textit{desktop} para simular um poço de extração de petróleo próximo do real contendo os equipamentos e variáveis encontrados ao utilizar o método de elevação artificial \textit{plunger lift}. Este simulador terá a capacidade de verificar as alterações ocorridas em um poço de acordo com algum tipo de controlador dados seus valores pré-determinados. Com os resultados mostrados pelo simulador, será possível a comparação dos dados adquiridos entre as simulações de controladores diferentes para um poço com condições iniciais iguais. O frequente aprimoramento do simulador para a aproximação da situação real e a apresentação dos dados calculados deve ser executado durante todo o trabalho de implementação para adequação aos novos itens adicionados e às novas funcionalidades.
\section{Desenvolvimento do simulador computacional}
\label{Sec:criacaosimulador}
O \textit{software} foi desenvolvido usando a ferramenta \textit{Eclipse MARS.1} para programar na linguagem de programação \textit{java}. A ferramenta \textit{Eclipse MARS.1} é utilizada para criar programas em diversas linguagens, mas normalmente é utilizado para programar em \textit{java}. A vantagem de desenvolver um \textit{software} em \textit{java} é a facilidade de programação, inclusive de componentes gráficos de interface de entrada e saída de dados, e sua portabilidade, executando em qualquer máquina que existir a JVM (\textit{Java Virtual Machine}). No processo de desenvolvimento, o programador deve resolver diversos problemas que são facilmente rastreáveis através da linguagem \textit{java} do que em outras linguagens existentes para auxiliar na sanação do problema.

Diferente de uma ferramenta RAD (\textit{Rapid Application Development}) onde existe a possibilidade de clicar e arrastar componentes para uma janela com o objetivo de tornar rápida o desenvolvimento de um \textit{software}, a construção do sistema foi realizada em uma IDE (\textit{Integrated Development Environment}) onde não há opção de criar interfaces mas não cria códigos em \textit{background}. Esta criação de código em \textit{background} torna o sistema lento e poluído para o programador trabalhar. Uma amostra da ferramenta \textit{Eclipse MARS.1} está de acordo com a figura \ref{Fig:eclipse} enquanto a janela mostra todos os arquivos do projeto à esquerda e o código de um dos arquivos na parte central. Esta ferramenta somente auxilia na gerência do código e arquivos adicionados ao projeto para que estejam todos incorporados e funcionando corretamente além da manutenção e ligação entre as classes criadas pelo desenvolvedor.

\begin{figure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/IDE_Eclipse}}
		\caption{Exemplo da tela de desenvolvimento do \textit{software Eclipse MARS.1}}
		\label{Fig:eclipse}
	\end{center}
\end{figure}

O simulador foi desenvolvido e adaptado para aceitar internacionalização do sistema. Esta característica permite, com poucas alterações, executar o simulador com todas as opções e funções em outras línguas como inglês ou francês. Para que isso seja possível, existe um arquivo no projeto com a definição de um identificador e o seu texto que deve ser apresentado. Então o desenvolvedor cria um arquivo para cada idioma em que deseja executar o simulador e altera o arquivo definido que contêm as interpretações desejadas para título, menus, botões e legendas. Ao alterar este arquivo, o programa deve ser executado em uma linguagem diferente para que usuários possam beneficiar do estudo deste método de elevação artificial.
\section{Organização do \textit{software}}
\label{Sec:organizacaosoftware}
Antes do desenvolvimento de um \textit{software}, deve ser levada em consideração a organização e arquitetura do sistema. Esta definição tem objetivo de evitar que o programa fique com código desnecessário e de difícil compreensão para um desenvolvedor. Entre as diversas maneiras que existem para organizar um sistema, foi escolhido o MVC (\textit{Model-View-Controller}) no qual o sistema deve ser dividido em três partes com objetivos distintos para obter o funcionamento preciso.

Para o simulador ser criado, foi necessário dividir o \textit{software} em três partes distintas: uma parte irá gerenciar a interface e entrada e saída de dados, outra irá executar os cálculos do modelo matemático referente ao método estudado \textit{plunger lift} e a última irá trabalhar somente para transferir os dados calculados do modelo matemático à interface e vice-versa. Cada uma dessas partes irá efetuar suas operações concorrentemente para não haver prejuízo no tempo de processamento durante o andamento do programa. Para que isso ocorra, cada uma destas partes devem ser criadas como \textit{threads} que representam tarefas concorrentes e permitem que programa execute mais suavemente do que em um processo com maior requisição de recursos do processador.

Segundo \cite{javier2012java}, concorrência é uma série de tarefas executando simultaneamente em um processador que pode ser real no caso do processor ter mais de um núcleo e aparente caso existir somente um núcleo. Durante a execução do sistema operacional, podem existir vários processos efetuando tarefas simultâneas, que se denominam \textit{threads} dentro de um processo. Outro termo utilizado é paralelismo, que normalmente é utilizado por autores para definir um processo com \textit{multi-threads} exercendo suas tarefas em um computador com mais de um processador.

Cada parte é desenvolvida em diretórios diferentes dentro do projeto para melhor gerência. A ligação existente entre os diretórios de classes se dão na relação de um-para-um, ou seja, entre diretórios somente uma classe se conecta à uma outra classe de outro diretório. Dessa forma é garantido uma maior segurança entre as mensagens trocadas durante a execução entre os processos, evitando problemas no andamento do sistema e desorganização de código. Outra vantagem deste tipo de abordagem é que, no caso em que ocorrer erros no sistema, estes serão mais facilmente rastreáveis e solucionados.
\section{Principais variáveis gerenciadas pelo simulador}
\label{Sec:variaveissimulador}
O modelo matemático implementado no simulador dispõe de diversas variáveis que podem ser observadas pelo usuário assim com existem diversas variáveis que podem ser definidas antes da execução começar. Estas definições podem ser realizadas com relação ao pistão utilizado no poço, estrutura da coluna de produção e anular, RGL (razão gás-óleo) do reservatório que está retirando óleo, tamanho inicial da golfada entre outras. O simulador está definido para apresentar certas variáveis (mostradas da figura \ref{Fig:variaveisgrafico}) em um gráfico em duas dimensões (figura \ref{Fig:grafico}) plotando os valores calculados pelo tempo decorrido. Antes da execução, o usuário deve definir as condições iniciais abrindo o menu de configuração (figura \ref{Fig:condicoesiniciais}) e alterar o padrão no que for necessário à simulação corrente.

\begin{figure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/variaveisgrafico}}
		\caption{Variáveis que podem ser plotadas no gráfico do simulador}
		\label{Fig:variaveisgrafico}
	\end{center}
\end{figure}

\begin{figure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/grafico}}
		\caption{Amostra do gráfico pertencente ao simulador mostrando uma execução}
		\label{Fig:grafico}
	\end{center}
\end{figure}

\begin{figure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/condicoesiniciais}}
		\caption{Definições iniciais para a execução do método \textit{plunger lift}}
		\label{Fig:condicoesiniciais}
	\end{center}
\end{figure}

Ao definir as condições iniciais do simulador, o usuário poderá executar e observar o andamento de certas variáveis durante os ciclos em que o \textit{software} continuar sendo executado podendo ser pausado e resumido ao comando do utente. Normalmente as variáveis seguem um aspecto recorrente, caso não ocorram problemas com o poço, devida a natureza cíclica do método.

Algumas variáveis importantes para um ciclo completo do método \textit{plunger lift} devem ser impressas em um arquivo de texto separado para análise na finalização do sistema pelo usuário. Estas variáveis seriam: tempo total do ciclo e de cada uma das suas etapas, tempo da válvula aberta e fechada, velocidade média do pistão na fase de subida, pressão máxima e mínima do anular, volume de produção no ciclo, o total de líquido produzido até o momento, velocidade de impacto do pistão e o tempo exato da chegada do pistão à superfície. Estes valores são únicos em cada ciclo do método e será utilizado no estudo da comparação entre controladores diferentes.
\section{Implementação de controladores}
\label{Sec:implementacaocontroladores}
A implementação e integração dos variados tipos de controladores ao simulador devem ser planejado de modo simples e que seja o mais organizado possível. Este planejamento envolve um estudo nos padrões de projeto, que representam as melhores formas de arquitetura de \textit{software} para resolução de diversos tipos de problemas. Uma análise de UML (\textit{Unified Modelling Language}) para ter segurança nos caminhos que a informação irá ser transportada entre as \textit{threads}, principalmente nos diagramas de classes e sequência.

O padrão de projeto que combina com a arquitetura mostrada para implementação destes controladores é chamada de \textit{Strategy}. Segundo \cite{gammapadroes}, o padrão de projeto \textit{Strategy} define uma família de algoritmos diferentes, encapsulando cada um deles em uma classe diferente e os faz alternáveis. O cliente que irá utilizá-los não precisa definir a qual classe recorrer. Este padrão é aplicável quando existem variantes de um algoritmo que modifica somente o seu comportamento quando é chamado no cliente. Sua estrutura é definida como na figura \ref{Fig:strategy}, fornecendo uma interface comum para todos os algoritmos, a implementação de cada um dos algoritmos e o objeto contexto para utilizar alguns dos algoritmos.

\begin{figure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/strategy}}
		\caption{Estrutura do padrão de projeto \textit{Strategy} para o simulador \textit{plunger lift}}
		\label{Fig:strategy}
	\end{center}
\end{figure}

Os tipos de controladores devem ser armazenados em um diretório separado com cada classe representando um controlador diferente e cada controlador deve estender de uma classe mãe com atributos e funções padrões com que todo controlador deve implementar. A simulação deve ser selecionada somente um controlador para cada execução e para testar outro controlador, a simulação necessita ser finalizada. Estes controladores farão parte do processo contendo o modelo matemático, alterando suas variáveis ou não durante a execução.

Para cada etapa do método \textit{plunger lift}, existe uma função associada no modelo matemático e em cada uma dessas funções existe uma iteração que executa numerosos cálculos diversas vezes até que seja o momento de sair da iteração e ir para outra etapa do método. No caso deste simulador, na condição da seleção de algum controlador, em cada iteração de qualquer uma dessas etapas deverá chamar a função do controlador selecionado e em seguida o objeto do controlador terá papel de verificar as condições do poço e tomar decisões ou não acerca das variáveis modificáveis do modelo. Dessa maneira o modelo não terá uma grande alteração em seu código e o controlador somente tomará decisões em certas partes contidas no ciclo do referido método, facilitando a programação e o compreendimento do funcionamento.