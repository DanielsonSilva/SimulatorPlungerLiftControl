%%
%% Capítulo 3: Simulador Computacional
%%
\mychapter{Simulador Computacional}
\label{Cap:simulador}
Um simulador computacional é uma ferramenta que auxilia no processo do estudo de um certo procedimento, simples ou complexo, que evita a má gerência de um sistema específico. O ajuste de parâmetros iniciais em um procedimento pode ser estudado previamente por um simulador computacional para obter maior segurança quando esta alteração for realizada em um sistema real. Na aquisição de conhecimento sobre o procedimento através do simulador, o operador será capaz de compreender e testar formas de otimizar aquele sistema específico seguindo algum objetivo especial. Alcançada esta otimização no simulador e verificada através de testes, o operador poderá ter maior garantia de sucesso ao aplicar a técnica em um processo na prática.

Com a finalidade de preparação para a implementação dos controladores descritos na seção \ref{Sec:controle}, foi desenvolvido e está sendo melhorado um aplicativo \textit{desktop} para simular um poço de extração de petróleo próximo do real contendo os equipamentos e outras variáveis que existem no método de elevação artificial \textit{plunger lift}. Este simulador terá a capacidade de verificar as alterações ocorridas em um poço de acordo com um tipo de controlador e seus parâmetros informados pelo usuário. Será possível a comparação dos dados adquiridos entre as simulações de controladores diferentes para um poço com condições iniciais iguais com os resultados mostrados pelo simulador.
\section{Desenvolvimento do simulador computacional}
\label{Sec:criacaosimulador}
O \textit{software} foi desenvolvido usando a ferramenta \textit{Eclipse MARS.1} para programar na linguagem de programação \textit{Java}. A ferramenta \textit{Eclipse MARS.1} é utilizada para criar programas em diversas linguagens, mas normalmente é utilizado para programar em \textit{Java}. A vantagem de desenvolver um \textit{software} em \textit{Java} é a facilidade de programação, inclusive de componentes gráficos de interface de entrada e saída de dados, e sua portabilidade, executando em qualquer máquina que existir a JVM (\textit{Java Virtual Machine}). O programador consegue resolver diversos problemas mais facilmente através da linguagem \textit{Java} do que em outras linguagens existentes durante a fase de desenvolvimento.

Diferente de uma ferramenta RAD (\textit{Rapid Application Development}) na qual existe a possibilidade de clicar e arrastar componentes para uma janela com o objetivo de tornar rápida o desenvolvimento de um \textit{software}, a construção do sistema foi realizada em uma IDE (\textit{Integrated Development Environment}) onde não há opção de criar interfaces mas não cria códigos em \textit{background}. Esta criação de código em \textit{background} torna o sistema lento e confuso pois adiciona muito código que não é utilizado pelo sistema. A ferramenta \textit{Eclipse MARS.1} está sendo mostrada na figura \ref{Fig:eclipse} exibindo todos os arquivos do projeto à esquerda e o código de um dos arquivos na parte central. Esta ferramenta ajuda na gerência do código e arquivos adicionados ao projeto para que estejam incorporados e funcionando corretamente, facilidade na manutenção e ligação entre as classes criadas pelo desenvolvedor.

\begin{figure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/IDE_Eclipse}}
		\caption{Exemplo da tela de desenvolvimento do \textit{software Eclipse MARS.1}}
		\label{Fig:eclipse}
	\end{center}
\end{figure}

O simulador foi desenvolvido e adaptado para aceitar internacionalização do sistema. Com poucas alterações esta característica permite executar o simulador com todas as legendas usadas no programa em outros idiomas como inglês ou francês. Estas definições ficam na pasta \textit{resources} dentro do projeto, um arquivo por idioma. Em cada arquivo existem definições de identificadores e o respectivo texto que deve ser apresentado no programa. Quando o programa for executar, é passado o idioma que deseja apresentar e então a classe principal do sistema seleciona o arquivo respectivo para aquele determinado idioma. Dessa forma, pessoas que não entendem o português brasileiro podem utilizar este sistema e obter proveito do estudo do método \textit{plunger lift}.
\section{Organização do \textit{software}}
\label{Sec:organizacaosoftware}
Antes do desenvolvimento de um \textit{software}, deve ser levada em consideração a organização e arquitetura do sistema. Esta definição tem objetivo de evitar que o programa fique com código desnecessário e de difícil compreensão para um desenvolvedor. O sistema foi ser dividido em três partes com objetivos distintos para obter o funcionamento preciso.

Uma das parte do simulador tem a responsabilidade de gerenciar a interface de entrada e saída de dados, outra executa os cálculos do modelo matemático referente ao método estudado e a última trabalha para transferir os dados calculados do modelo matemático à interface e os dados de entrada para o modelo matemático. Cada uma dessas partes irá efetuar suas operações concorrentemente para não haver prejuízo no tempo de processamento durante o andamento do programa. Para que isso ocorra, cada parte foi criada como uma \textit{thread}. \textit{Threads} representam tarefas concorrentes e permitem que programa execute mais suavemente comparado a somente uma tarefa realizando todas as atividades.

Segundo \cite{javier2012java}, concorrência é uma série de tarefas executando simultaneamente em um processador, que pode ser real no caso do processor ter mais de um núcleo ou aparente caso existir somente um núcleo. Durante a execução do sistema operacional, podem existir vários processos efetuando tarefas simultâneas, que se denominam \textit{threads} dentro de um processo. Outro termo utilizado é paralelismo, que normalmente é utilizado por autores para definir um processo com \textit{multi-threads} exercendo suas tarefas em um computador com mais de um processador.

Cada uma das partes do simulador é desenvolvida em diretórios diferentes dentro do projeto para melhor gerência. A ligação existente entre os diretórios de classes se dão na relação de um-para-um, ou seja, entre diretórios somente uma classe se conecta à uma outra classe de outro diretório. Dessa forma é garantido uma maior segurança entre as mensagens trocadas durante a execução entre as \textit{threads}, evitando problemas no andamento do sistema e desorganização de código. Outra vantagem deste tipo de abordagem é que, no caso em que ocorrer erros no sistema, estes serão mais facilmente rastreáveis e solucionados.
\section{Principais variáveis gerenciadas pelo simulador}
\label{Sec:variaveissimulador}
O modelo matemático implementado no simulador dispõe de diversas variáveis que podem ser observadas pelo usuário assim com existem diversas variáveis que podem ser definidas antes da execução começar. Estas definições podem ser realizadas com relação ao pistão utilizado no poço, estrutura da coluna de produção e anular, RGL (razão gás-óleo) do reservatório que está retirando óleo, tamanho inicial da golfada entre outras. O simulador está definido para apresentar certas variáveis (mostradas da figura \ref{Fig:variaveisgrafico}) em um gráfico de duas dimensões (figura \ref{Fig:grafico}) plotando os valores calculados pelo tempo decorrido. Antes da execução, o usuário deve definir as condições iniciais abrindo o menu de configuração (figura \ref{Fig:condicoesiniciais}) e alterar as características que forem necessárias ao teste de simulação.

\begin{figure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/variaveisgrafico}}
		\caption{Variáveis que podem ser plotadas no gráfico do simulador}
		\label{Fig:variaveisgrafico}
	\end{center}
\end{figure}

\begin{sidewaysfigure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/grafico}}
		\caption{Amostra do gráfico pertencente ao simulador mostrando uma execução}
		\label{Fig:grafico}
	\end{center}
\end{sidewaysfigure}

\begin{figure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/condicoesiniciais}}
		\caption{Definições iniciais para a execução do método \textit{plunger lift}}
		\label{Fig:condicoesiniciais}
	\end{center}
\end{figure}

Ao definir as condições iniciais do simulador, o usuário poderá executar e observar o andamento de certas variáveis durante os ciclos em que o \textit{software} continuar sendo executado podendo ser pausado e resumido ao comando do utente. Caso não ocorram problemas com o poço as variáveis seguem um aspecto recorrente devida a natureza cíclica do método.

Algumas variáveis importantes para um ciclo completo do método \textit{plunger lift} devem ser impressas em um arquivo de texto separado para análise na finalização do sistema pelo usuário. Estas variáveis seriam: tempo total do ciclo e de cada uma das suas etapas, tempo da válvula aberta e fechada, velocidade média do pistão na fase de subida, pressão máxima e mínima do anular, volume de produção no ciclo, o total de líquido produzido até o momento, velocidade de impacto do pistão e o tempo exato da chegada do pistão à superfície. Estes valores são únicos em cada ciclo do método e será utilizado no estudo da comparação entre diferentes controladores.

\section{Implementação de controladores}
\label{Sec:implementacaocontroladores}
A implementação e integração dos variados tipos de controladores ao simulador devem ser planejados de modo simples e de forma organizada. Este planejamento envolve um estudo nos padrões de projeto, que representam as melhores formas de arquitetura de \textit{software} para resolução de diversos tipos de problemas. Uma análise de UML (\textit{Unified Modelling Language}) é recomendada para garantir por onde a informação será transportada entre as \textit{threads}, principalmente no diagrama de classe.

O padrão de projeto que é utilizada para organização da implementação destes controladores é chamada de \textit{Strategy}. Segundo \cite{gammapadroes}, o padrão de projeto \textit{Strategy} define uma família de algoritmos diferentes, encapsulando cada um deles em uma classe diferente e os faz alternáveis. O cliente que utilizá-los não precisa definir a qual classe recorrer. Este padrão é aplicável quando existem variantes de um algoritmo que modifica somente o seu comportamento quando é chamado no cliente. Sua estrutura é definida como na figura \ref{Fig:strategy}, fornecendo uma interface comum para todos os algoritmos, a implementação de cada um dos algoritmos e o objeto contexto para utilizar os algoritmos.

\begin{figure}[htbp!]
	\begin{center}
		\fbox{\includegraphics[width=1.00\linewidth]{simulador/strategy}}
		\caption{Estrutura do padrão de projeto \textit{Strategy} para o simulador \textit{plunger lift}}
		\label{Fig:strategy}
	\end{center}
\end{figure}

Os tipos de controladores devem ser armazenados em um diretório separado com cada classe representando um controlador diferente e cada controlador deve estender de uma classe com atributos e funções padrões com que todo controlador deve implementar. A simulação deve ser selecionada somente um controlador para cada execução. A simulação necessita ser finalizada para testar outro controlador. Estes controladores fazem parte do processo contendo o modelo matemático, alterando suas variáveis ou não durante a execução do processo.

Para cada etapa do método \textit{plunger lift}, existe uma função associada no modelo matemático e em cada uma dessas funções existe uma iteração que executa numerosos cálculos diversas vezes até que seja o momento de sair da iteração e executar outra etapa do método. Em cada iteração de qualquer das etapas é chamada a função do controlador selecionado de checagem, em seguida o objeto do controlador verifica as condições do poço e decide se modifica ou não certas variáveis do poço. Dessa maneira os cálculos e iterações do modelo não necessitam passar por adaptações no código e o controlador pode modificar as variáveis do poço em certas partes contidas no ciclo do referido método, facilitando a programação e o compreendimento do funcionamento da execução do \textit{software}.